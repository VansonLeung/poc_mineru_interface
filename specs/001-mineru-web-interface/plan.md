# Implementation Plan: Miner-U Web Interface and Dify API

**Branch**: `001-mineru-web-interface` | **Date**: 2025-12-16 | **Spec**: [`spec.md`](./spec.md)
**Input**: Feature specification from `/specs/001-mineru-web-interface/spec.md`

**Note**: This plan follows the constitution gates and the speckit.plan workflow.

## Summary

Build a synchronous Miner-U 2.6.8 document parsing service with a web UI and an HTTP API (`POST /api/v1/parse`) that accepts PDFs/images and returns Markdown and JSON in-line. Support CORS (all origins, credentials=false), enforce file limits (<=50MB or 50 pages), and provide observability and health endpoints. Outputs are stored temporarily and returned directly without async polling.

## Technical Context

**Language/Version**: Python 3.11  
**Primary Dependencies**: FastAPI, Uvicorn, Miner-U 2.6.8, Pydantic, httpx (tests), loguru  
**Storage**: Local filesystem temp outputs (ephemeral, per-job cleanup)  
**Testing**: pytest, pytest-asyncio, httpx client for API, optional Playwright for UI e2e  
**Target Platform**: Linux/macOS server; containerized deployment expected  
**Project Type**: Web (backend + frontend)  
**Performance Goals**: 95% of <=50MB or <=50-page jobs complete within 60s; <2% failure over 500 requests  
**Constraints**: Synchronous responses only; reject/limit oversized or long-running jobs to meet latency budgets; CORS allow-all, credentials false  
**Scale/Scope**: Initial single-tenant deployment; concurrent uploads sized for small team/PoC use

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **Architecture boundaries**: Defined modules: frontend UI, backend API, processing orchestrator, storage temp layer, observability.
- **Test-first plan**: Contract tests for `POST /api/v1/parse`, integration tests with Miner-U sample PDF/image, UI e2e; target >=85% coverage for changes.
- **Contracts & versioning**: API versioned under `/api/v1`; request/response schema documented in contracts; breaking changes require new version path.
- **Documentation**: Spec, plan, data-model, contracts, quickstart to be delivered; public docs updated alongside code.
- **Observability**: Structured logs (request_id, file, duration), metrics, `/health` readiness, alert thresholds planned.
- **Security & data handling**: Secrets via env; open CORS with no credentials per requirement; temp storage with expiry; dependency scanning planned.
- **Quality gates**: CI to run lint/format/tests/contract checks/coverage; maintainer review required. **Status**: All gates satisfied (no violations).

## Project Structure

### Documentation (this feature)

```text
specs/001-mineru-web-interface/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
└── tasks.md  # generated by /speckit.tasks
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── api/            # FastAPI routers, request/response models
│   ├── services/       # orchestration, mineru integration, validation, storage
│   ├── models/         # domain models (DocumentSubmission, ParseJob, OutputBundle)
│   ├── config/         # settings, limits, CORS policy
│   └── observability/  # logging, metrics, health
└── tests/
    ├── unit/
    ├── contract/
    └── integration/

frontend/
├── src/
│   ├── components/     # upload form, progress, result viewers
│   ├── pages/          # main upload page
│   └── services/       # API client
└── tests/
    └── e2e/            # upload→parse→download flow
```

**Structure Decision**: Web application split into `backend/` (FastAPI service) and `frontend/` (web UI). Tests colocated per layer.

## Complexity Tracking

No constitution violations; table not required.
